+------------------------------+                                                                     
|         "1Ô∏è‚É£ Input"          |                                                                     
|                              |                                                                     
|                              |                                                                     
| +--------------------------+ |                                                                     
| |                          | |                                                                     
| |        "üë§ User"         |<-+                                                                    
| |                          | ||                                                                    
| +--------------------------+ ||                                                                    
|               |              ||                                                                    
|               |              ||                                                                    
|               |              ||                                                                    
|               |              ||                                                                    
|               v              ||                                                                    
| +--------------------------+ ||                                                                    
| |                          | ||                                                                    
| |     "Input Message"      | ||                                                                    
| |                          | ||                                                                    
| +--------------------------+ ||                                                                    
|               |              ||                                                                    
+---------------|--------------+|                                                                    
                |               |                                                                    
                |               |                                                                    
                |               |                                                                    
+---------------|--------------+|                                                                    
|        "2Ô∏è‚É£ Session"         ||                                                                    
|               |              ||                                                                    
|               v              ||                                                                    
| +--------------------------+ ||                                                                    
| |                          | ||                                                                    
| |        "CLI/TUI"         | ||                                                                    
| |                          | ||                                                                    
| +--------------------------+ ||                                                                    
|               |              ||                                                                    
|               |              ||                                                                    
|               |              ||                                                                    
|               |              ||                                                                    
|               v              ||                                                                    
| +--------------------------+ ||                                                                    
| |                          | ||                                                                    
| |        "Session"         | ||                                                                    
| |                          | ||                                                                    
| +--------------------------+ ||                                                                    
|               |              ||                                                                    
|               |              ||                                                                    
|               |              ||                                                                    
|               |              ||                                                                    
|               v              ||                                                                    
| +--------------------------+ ||                                                                    
| |                          | ||                                                                    
| |     "MessageV2.User"     | ||                                                                    
| |                          | ||                                                                    
| +--------------------------+ ||                                                                    
|               |              ||                                                                    
+---------------|--------------+|                                                                    
                |               |                                                                    
                |               |                                                                    
                |               |                                                                    
+---------------|---------------|-------------------------------------------------------------------+
|               |               |        "3Ô∏è‚É£ System Prompt"                                        |
|               |               |                                                                   |
|               v               |                                                                   |
| +--------------------------+  |                                                                   |
| |                          |  |                                                                   |
| |      "SystemPrompt"      |--|--+--------+                                                       |
| |                          |  |  |        |                                                       |
| +--------------------------+  |  +-----------------------------+----------------------+           |
|               |               |           |                    |                      |           |
|               |               |           |                    |                      |           |
|               |               |           |                    |                      |           |
|               |               |           |                    |                      |           |
|               v               |           v                    v                      v           |
| +--------------------------+  |  +----------------+     +------------+     +--------------------+ |
| |                          |  |  |                |     |            |     |                    | |
| |        "header()"        |  |  |  "provider()"  |     | "custom()" |     | "markdownMemory()" | |
| |                          |  |  |                |     |            |     |                    | |
| +--------------------------+  |  +----------------+     +------------+     +--------------------+ |
|                               |                                |                      |           |
+-------------------------------|--------------------------------|----------------------|-----------+
                                |                                |                      |            
                                |                                |                      |            
                                |                                |                      |            
+------------------------------+|                                |                      |            
|      "4Ô∏è‚É£ LLM Stream"        ||                                |                      |            
|                              ||                                |                      |            
|                              ||                                |                      |            
| +--------------------------+ ||                                |                      |            
| |                          | ||                                |                      |            
| |      "LLM.stream()"      |<-|--------------------------------+----------------------+            
| |                          | ||                                                                    
| +--------------------------+ ||                                                                    
|               |              ||                                                                    
|               |              ||                                                                    
|               |              ||                                                                    
|               |              ||                                                                    
|               v              ||                                                                    
| +--------------------------+ ||                                                                    
| |                          | ||                                                                    
| | "Provider.getLanguage()" | ||                                                                    
| |                          | ||                                                                    
| +--------------------------+ ||                                                                    
|               |              ||                                                                    
|               |              ||                                                                    
|               |              ||                                                                    
|               |              ||                                                                    
|               v              ||                                                                    
| +--------------------------+ ||                                                                    
| |                          | ||                                                                    
| |     "LanguageModel"      | ||                                                                    
| |                          | ||                                                                    
| +--------------------------+ ||                                                                    
|               |              ||                                                                    
+---------------|--------------+|                                                                    
                |               |                                                                    
                |               |                                                                    
                |               |                                                                    
+---------------|--------------+|                                                                    
|      "5Ô∏è‚É£ AI Provider"       ||                                                                    
|               |              ||                                                                    
|               v              ||                                                                    
| +--------------------------+ ||                                                                    
| |                          | ||                                                                    
| |     "AI API Request"     |<-+                                                                    
| |                          | ||                                                                    
| +--------------------------+ ||                                                                    
|               |              ||                                                                    
|               |              ||                                                                    
|               |              ||                                                                    
|               |              ||                                                                    
|               v              ||                                                                    
| +--------------------------+ ||                                                                    
| |                          | ||                                                                    
| |   "Streaming Response"   | ||                                                                    
| |                          | ||                                                                    
| +--------------------------+ ||                                                                    
|               |              ||                                                                    
|               |              ||                                                                    
|               |              ||                                                                    
|               |              ||                                                                    
|               v              ||                                                                    
| +--------------------------+ ||                                                                    
| |                          | ||                                                                    
| |      "Token Chunks"      | ||                                                                    
| |                          | ||                                                                    
| +--------------------------+ ||                                                                    
|               |              ||                                                                    
+---------------|--------------+|                                                                    
                |               |                                                                    
                |               |                                                                    
                |               |                                                                    
+---------------|--------------+|                                                                    
|    "6Ô∏è‚É£ Tool Execution"      ||                                                                    
|               |              ||                                                                    
|               v              ||                                                                    
| +--------------------------+ ||                                                                    
| |                          | ||                                                                    
| |        Tool Call?        |--|--No-------+                                                        
| |                          | ||           |                                                        
| +--------------------------+ ||           |                                                        
|               |              ||           |                                                        
|               |              ||           |                                                        
|               |              ||           |                                                        
|               |              ||           |                                                        
|              Yes             ||           |                                                        
|               |              ||           |                                                        
|               |              ||           |                                                        
|               |              ||           |                                                        
|               v              ||           v                                                        
| +--------------------------+ ||  +----------------+                                                
| |                          | ||  |                |                                                
| |      "Execute Tool"      | ||  | "Final Result" |                                                
| |                          | ||  |                |                                                
| +--------------------------+ ||  +----------------+                                                
|               |              ||           |                                                        
|               |              ||           |                                                        
|               |              ||           |                                                        
|               |              ||           |                                                        
|               v              ||           v                                                        
| +--------------------------+ ||  +----------------+                                                
| |                          | ||  |                |                                                
| |      "Tool Result"       |--+  |  "Event Bus"   |                                                
| |                          | ||  |                |                                                
| +--------------------------+ ||  +----------------+                                                
|                              ||           |                                                        
+------------------------------+|           |                                                        
                                |           |                                                        
+-------------------------------|-----------|---------+                                              
|                   "7Ô∏è‚É£ Response"          |         |                                              
| +--------------------------+  |           |         |                                              
| |                          |  |           |         |                                              
| |    "Display Response"    |<-+-----------+         |                                              
| |                          |                        |                                              
| +--------------------------+                        |                                              
|                                                     |                                              
+-----------------------------------------------------+                                              
