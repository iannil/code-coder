{
  "$schema": "https://code-coder.com/config.json",

  // ============================================================================
  // CORE CONFIGURATION (Rust + TypeScript)
  // Used by: zero-gateway, zero-channels, zero-workflow, zero-trading, ccode
  // ============================================================================

  // Global network configuration - controls bind address for all services
  "network": {
    "bind": "127.0.0.1",           // "0.0.0.0" for remote access
    "public_url": "https://example.com"  // Optional: for callbacks behind proxy/tunnel
  },

  // Simplified service port configuration
  "services": {
    "codecoder": { "port": 4400 },
    "gateway": { "port": 4430 },
    "channels": { "port": 4431 },
    "workflow": { "port": 4432 },
    "trading": { "port": 4434 }
  },

  // Authentication configuration
  "auth": {
    "mode": "pairing",             // "pairing" | "jwt" | "none"
    "jwt_secret": "your-secret",   // Auto-generated if not set
    "token_expiry_secs": 86400     // 24 hours
  },

  // Grouped secrets - all sensitive credentials organized by category
  "secrets": {
    "llm": {
      "anthropic": "sk-ant-xxx",
      "openai": "sk-xxx",
      "deepseek": "sk-xxx",
      "google": "xxx",
      "openrouter": "sk-or-xxx",
      "groq": "gsk_xxx",
      "mistral": "xxx",
      "xai": "xxx",
      "together": "xxx",
      "fireworks": "xxx",
      "perplexity": "pplx-xxx",
      "cohere": "xxx",
      "cloudflare": "xxx",
      "venice": "xxx",
      "moonshot": "xxx",
      "glm": "xxx",
      "minimax": "xxx",
      "qianfan": "xxx"
    },
    "channels": {
      "telegram_bot_token": "123456:ABC-xxx",
      "discord_bot_token": "xxx",
      "slack_bot_token": "xoxb-xxx",
      "slack_app_token": "xapp-xxx",
      "feishu_app_id": "xxx",
      "feishu_app_secret": "xxx"
    },
    "external": {
      "itick": "xxx",                       // iTick API key for A-share market data (replaces deprecated tushare)
      "lixin": "xxx",                       // Lixin (理杏仁) API token
      "cloudflare_tunnel": "eyJxxx",
      "ngrok_auth": "xxx",
      "elevenlabs": "xxx"
    }
  },

  // Tunnel configuration for external access
  // Each provider requires its specific object structure (null is not valid)
  "tunnel": {
    "provider": "cloudflare",             // "none" | "cloudflare" | "tailscale" | "ngrok" | "custom"
    // Only configure the provider you're using; omit others
    "cloudflare": {                       // Cloudflare Tunnel (Zero Trust)
      "token": "eyJxxx"                   // Token from Cloudflare Zero Trust dashboard
    },
    "tailscale": {                        // Tailscale Tunnel
      "funnel": false,                    // true = public internet, false = tailnet only
      "hostname": "myhost"                // Optional hostname override
    },
    "ngrok": {                            // ngrok Tunnel
      "auth_token": "xxx",                // ngrok auth token
      "domain": "example.ngrok.io"        // Optional custom domain
    },
    "custom": {                           // Custom tunnel command
      "start_command": "bore local {port} --to bore.pub",  // Use {port} and {host} placeholders
      "health_url": "https://example.com/health",          // Optional health check URL
      "url_pattern": "listening on (https://[^ ]+)"        // Optional regex to extract public URL
    }
  },

  // Simplified LLM configuration (consolidated from old providers + reliability)
  "llm": {
    "default": "anthropic/claude-sonnet-4-20250514",
    "retries": 2,                   // Number of retries before fallback
    "backoff_ms": 1000,             // Backoff between retries
    "fallbacks": [],                // Fallback provider chain
    "providers": {
      "deepseek": {
        "base_url": "https://api.deepseek.com",
        "models": ["deepseek-chat", "deepseek-coder"]
      }
    },
    "ollama": {
      "base_url": "http://localhost:11434",
      "default_model": "llama3",
      "timeout_secs": 300
    }
  },

  // Voice configuration (TTS/STT)
  "voice": {
    "tts": { "provider": "compatible", "voice": "nova" },
    "stt": { "provider": "local", "model": "base" }
  },

  // Observability configuration
  // Note: Accepts both "log_level"/"log_format" (canonical) and "level"/"format" (alias)
  "observability": {
    "log_level": "info",           // trace | debug | info | warn | error
    "log_format": "pretty",        // json | pretty
    "tracing": true,               // Enable distributed tracing
    "show_trace_id": false,        // Include trace_id in log output (useful for debugging)
    "excluded_targets": []         // Log targets to exclude (e.g., ["hyper", "tower"])
  },

  // Channel enable configuration
  "channels": {
    "telegram": {
      "enabled": true,
      "allowed_users": ["username"]
    },
    "discord": {
      "enabled": false,
      "allowed_users": []
    },
    "slack": {
      "enabled": false,
      "allowed_users": []
    },
    "feishu": {
      "enabled": false,
      "allowed_users": []
    }
  },

  // Trading configuration (zero-trading service)
  // Note: "notification" is alias for "telegram_notification", "loop" is alias for "loop_config"
  "trading": {
    "paper_trading": true,         // Or use "mode": "paper" (alias, deprecated)
    "smt_pairs": [
      {
        "primary": "000300.SH",
        "reference": "000905.SH",
        "name": "沪深300 vs 中证500",
        "description": "大盘股 vs 中盘股背离"
      }
    ],
    "timeframes": ["D", "H4", "H1"],
    "min_accumulation_bars": 10,
    "manipulation_threshold": 1.5,
    "require_alignment": true,
    "signal_expiry_minutes": 60,
    "max_positions": 5,
    "max_position_pct": 20.0,
    "max_daily_capital_pct": 50.0,
    "default_stop_loss_pct": 3.0,
    "auto_execute": false,
    "macro_filter_enabled": true,
    "macro_cache_secs": 3600,
    "telegram_notification": {     // Canonical name (or use "notification" alias)
      "enabled": true,
      "telegram_chat_id": "123456789",
      "channel_type": "telegram",
      "retry_count": 3,
      "notify_signals": true,
      "notify_orders": true,
      "notify_positions": true
    },
    "macro_agent": {
      "enabled": true,
      "timeout_secs": 30,
      "cache_duration_secs": 3600,
      // Weekly report (every Monday 9:00 AM Beijing time)
      "weekly_report_enabled": true,
      "weekly_report_cron": "0 0 9 * * 1",
      // Monthly report (1st day of each month 9:00 AM Beijing time)
      "monthly_report_enabled": true,
      "monthly_report_cron": "0 0 9 1 * *",
      // Daily morning report (pre-market, 9:00 AM Beijing time, weekdays)
      "daily_morning_enabled": true,
      "daily_morning_cron": "0 0 9 * * *",
      // Daily afternoon report (post-market, 4:00 PM Beijing time, weekdays)
      "daily_afternoon_enabled": true,
      "daily_afternoon_cron": "0 0 16 * * *",
      // Include index data (000300.SH, 000905.SH, 000001.SH) in daily reports
      "include_index_data": true,
      "index_symbols": ["000300.SH", "000905.SH", "000001.SH"]
    },
    "loop_config": {               // Canonical name (or use "loop" alias)
      "interval_secs": 5,
      "price_check_interval_secs": 1,
      "auto_execute": false
    },
    "schedule": {
      "enabled": false,
      "session_start": "0 25 9 * * 1-5",
      "session_pause": "0 30 11 * * 1-5",
      "session_resume": "0 0 13 * * 1-5",
      "session_stop": "0 0 15 * * 1-5",
      "daily_review": "0 30 15 * * 1-5",
      "auto_start": true,
      "persist_state": true,
      "default_mode": "paper"
    },
    "data_sources": {
      "sources": [
        {
          "provider": "itick",
          "enabled": true,
          "priority": 1,
          "config": {
            "rate_limit_rpm": 300    // 5 req/sec (free tier default)
          }
        },
        {
          "provider": "lixin",
          "enabled": true,
          "priority": 2,
          "config": {
            "rate_limit_rpm": 100    // Conservative default (varies by tier)
          }
        }
      ],
      "health_check_interval_secs": 30,    // Interval between health checks (default: 30)
      "unhealthy_threshold": 3,            // Consecutive failures before unhealthy (default: 3)
      "max_retries": 2,                    // Retries per provider before failover (default: 2)
      "health_check_timeout_secs": 10      // Timeout for health check requests (default: 10)
    }
  },

  // ============================================================================
  // TYPESCRIPT CODECODER TUI CONFIGURATION
  // Used by: packages/ccode (TUI/CLI only, Rust services ignore these)
  // ============================================================================

  "theme": "dark",
  "model": "anthropic/claude-sonnet-4-20250514",
  "small_model": "anthropic/claude-haiku-3-5-20241022",
  "default_agent": "build",
  "username": "user",
  "logLevel": "info",

  // Keybinds configuration
  "keybinds": {
    "leader": "ctrl+x",
    "app_exit": "ctrl+c,ctrl+d,<leader>q",
    "editor_open": "<leader>e",
    "theme_list": "<leader>t",
    "sidebar_toggle": "<leader>b",
    "model_list": "<leader>m",
    "agent_list": "<leader>a",
    "session_new": "<leader>n",
    "session_list": "<leader>l"
  },

  // TUI specific settings
  "tui": {
    "scroll_speed": 1.0,
    "scroll_acceleration": { "enabled": true },
    "diff_style": "auto"
  },

  // Server configuration for codecoder serve command
  "server": {
    "port": 4400,
    "hostname": "127.0.0.1",
    "mdns": false,
    "cors": ["http://localhost:4401"],
    "apiKey": "xxx"
  },

  // Redis configuration for conversation store
  "redis": {
    "url": "redis://localhost:6379",
    "password": "xxx",
    "db": 0,
    "keyPrefix": "codecoder:",
    "connectTimeout": 5000,
    "commandTimeout": 3000,
    "maxRetriesPerRequest": 3
  },

  // Custom command configuration
  "command": {
    "review": {
      "template": "Review the following code:\n{input}",
      "description": "Code review command",
      "agent": "code-reviewer",
      "model": "anthropic/claude-sonnet-4-20250514"
    }
  },

  // Agent configuration
  "agent": {
    "build": {
      "model": "anthropic/claude-sonnet-4-20250514",
      "temperature": 0.7,
      "mode": "primary",
      "steps": 50,
      "color": "#4A90D9"
    },
    "plan": {
      "model": "anthropic/claude-sonnet-4-20250514",
      "mode": "primary"
    },
    "explore": {
      "model": "anthropic/claude-haiku-3-5-20241022",
      "mode": "subagent",
      "hidden": false
    }
  },

  // Custom provider configurations
  "provider": {
    "zhipu-ai": {
      "api": "https://open.bigmodel.cn/api/coding/paas/v4",
      "name": "Zhipu AI",
      "npm": "@ai-sdk/openai-compatible",
      "models": {
        "glm-5": {
          "id": "glm-5",
          "name": "GLM-5",
          "tool_call": true,
          "limit": { "context": 128000, "output": 4096 },
          "modalities": { "input": ["text"], "output": ["text"] }
        }
      },
      "options": {
        "apiKey": "xxx",
        "baseURL": "https://open.bigmodel.cn/api/coding/paas/v4"
      }
    }
  },

  // MCP (Model Context Protocol) server configurations
  "mcp": {
    "server": {
      "apiKey": "xxx",
      "port": 4420,
      "defaultTransport": "stdio",
      "resources": ["**/*.md"]
    },
    "playwright": {
      "type": "local",
      "command": ["npx", "@anthropic-ai/mcp-server-playwright"],
      "environment": {},
      "enabled": true,
      "timeout": 60000
    },
    "remote-server": {
      "type": "remote",
      "url": "https://mcp.example.com",
      "enabled": true,
      "headers": { "Authorization": "Bearer xxx" },
      "timeout": 5000
    }
  },

  // Code formatter configuration
  "formatter": {
    "prettier": {
      "disabled": false,
      "command": ["npx", "prettier", "--write"],
      "extensions": [".js", ".ts", ".tsx", ".json"]
    }
  },

  // LSP server configuration
  "lsp": {
    "typescript-language-server": {
      "command": ["typescript-language-server", "--stdio"],
      "extensions": [".ts", ".tsx", ".js", ".jsx"],
      "disabled": false
    }
  },

  // Markdown files to load as instructions
  "instructions": ["./CLAUDE.md", "./docs/**/*.md"],

  // Permission configuration
  "permission": {
    "read": "allow",
    "edit": "ask",
    "bash": {
      "git *": "allow",
      "npm *": "ask",
      "*": "deny"
    },
    "task": "allow",
    "webfetch": "ask",
    "websearch": "ask"
  },

  // File watcher configuration
  "watcher": {
    "ignore": ["node_modules", ".git", "dist"]
  },

  // Session compaction configuration
  "compaction": {
    "auto": true,
    "prune": true
  },

  // Auto-update setting
  "autoupdate": "notify",

  // Provider filtering
  "disabled_providers": [],
  "enabled_providers": [],

  // Snapshot mode
  "snapshot": false,

  // Autonomous mode configuration
  "autonomousMode": {
    "enabled": false,
    "autonomyLevel": "timid",
    "unattended": false,
    "resourceLimits": {
      "maxTokens": 1000000,
      "maxCostUSD": 10.0,
      "maxDurationMinutes": 60,
      "maxFilesChanged": 20,
      "maxActions": 100
    }
  },

  // ZeroBot daemon configuration
  "zerobot": {
    "default_provider": "anthropic",
    "default_model": "claude-sonnet-4-20250514",
    "default_temperature": 0.7,
    "workspace_dir": "~/.codecoder/workspace",
    "observability": { "backend": "log" },
    "autonomy": {
      "level": "supervised",
      "workspace_only": true,
      "allowed_commands": ["git", "npm", "bun"],
      "forbidden_paths": ["/etc", "/usr"],
      "max_actions_per_hour": 100,
      "max_cost_per_day_cents": 1000
    },
    "runtime": { "kind": "native" },
    "reliability": {
      "provider_retries": 2,
      "provider_backoff_ms": 1000,
      "fallback_providers": ["openai"],
      "channel_initial_backoff_secs": 2,
      "channel_max_backoff_secs": 60
    },
    "heartbeat": {
      "enabled": true,
      "interval_minutes": 5
    },
    "memory": {
      "backend": "sqlite",
      "auto_save": true,
      "hygiene_enabled": true,
      "embedding_provider": "openai",
      "embedding_model": "text-embedding-3-small"
    },
    "gateway": {
      "port": 3000,
      "host": "127.0.0.1",
      "require_pairing": true,
      "allow_public_bind": false
    },
    "tunnel": {
      "provider": "cloudflare",
      "cloudflare": { "token": "xxx" },
      "tailscale": { "funnel": false, "hostname": "myhost" },
      "ngrok": { "auth_token": "xxx", "domain": "example.ngrok.io" }
    },
    "channels": {
      "cli": true,
      "telegram": {
        "bot_token": "xxx",
        "allowed_users": ["admin"],
        "voice": {
          "enabled": true,
          "stt_provider": "openai",
          "stt_model": "whisper-1",
          "stt_api_key": "xxx"
        }
      },
      "discord": {
        "bot_token": "xxx",
        "guild_id": "xxx",
        "allowed_users": []
      },
      "slack": {
        "bot_token": "xxx",
        "app_token": "xxx",
        "channel_id": "xxx"
      },
      "feishu": {
        "enabled": true,
        "app_id": "xxx",
        "app_secret": "xxx",
        "encrypt_key": "xxx",
        "verification_token": "xxx",
        "allowed_users": ["*"],
        "use_lark_api": false
      }
    },
    "browser": {
      "enabled": false,
      "allowed_domains": ["github.com", "stackoverflow.com"]
    },
    "codecoder": {
      "enabled": true,
      "endpoint": "http://localhost:4400"
    },
    "session": {
      "enabled": true,
      "context_window": 128000,
      "compact_threshold": 0.8,
      "keep_recent": 5
    },
    "tts": {
      "enabled": false,
      "provider": "openai",
      "api_key": "xxx",
      "model": "tts-1",
      "voice": "alloy"
    }
  },

  // Experimental features
  "experimental": {
    "hook": {
      "file_edited": {
        "*.ts": [
          {
            "command": ["npx", "prettier", "--write"],
            "environment": {}
          }
        ]
      },
      "session_completed": [
        {
          "command": ["notify-send", "Session completed"],
          "environment": {}
        }
      ]
    },
    "chatMaxRetries": 3,
    "disable_paste_summary": false,
    "batch_tool": false,
    "openTelemetry": false,
    "primary_tools": ["Task", "Edit", "Write"],
    "continue_loop_on_deny": false,
    "mcp_timeout": 5000,
    "observability": {
      "enabled": true,
      "level": "info",
      "sampling": 1.0
    }
  }
}
