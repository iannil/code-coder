# 架构决策记录 (ADR) 模板

> 文档类型: 架构决策模板
> 创建时间: {YYYY-MM-DD}

---

## 决策概要

**标题**: {简短描述，如 "用户认证模块技术选型"}

**状态**: [提议中 | 已采纳 | 已废弃 | 已替代]

**决策者**: {谁做出了这个决策}

---

## 背景

### 问题描述

{描述需要解决的问题或需求}

### 约束条件

- {约束1}
- {约束2}

---

## 确定性/不确定性评估

> **核心问题**: 这个功能是确定性的还是不确定性的？

### 评估清单

| 维度 | 评估 | 说明 |
|------|------|------|
| 输入输出可预测性 | 高/中/低 | {是否可以完全枚举输入输出映射} |
| 规则明确度 | 高/中/低 | {规则是否无歧义} |
| 需要"理解"能力 | 是/否 | {是否需要语义理解或推理} |
| 错误可枚举性 | 高/中/低 | {错误情况是否可以完全列举} |
| 性能敏感度 | 高/中/低 | {对延迟的要求} |

### 推荐归属

基于以上评估，此功能应归属于：

- [ ] **zero-* (Rust)** - 高确定性，需要性能和安全保证
- [ ] **ccode (LLM)** - 低确定性，需要推理和理解能力
- [ ] **混合模式** - 规则引擎 + LLM 分析

---

## 决策方案

### 方案 A: {方案名称}

**描述**: {方案详细描述}

**优点**:
- {优点1}
- {优点2}

**缺点**:
- {缺点1}
- {缺点2}

### 方案 B: {方案名称}

**描述**: {方案详细描述}

**优点**:
- {优点1}
- {优点2}

**缺点**:
- {缺点1}
- {缺点2}

---

## 最终决策

**选定方案**: {方案X}

**理由**: {为什么选择这个方案}

---

## 实现指南

### 代码位置

- 主要文件: `{路径}`
- 相关接口: `{路径}`

### 参考实现

- 类似功能: `{已有类似实现的路径}`
- 设计模式: `{使用的设计模式名称}`

### 如果选择混合模式

参考 `services/zero-common/src/hybrid.rs` 中的 `HybridDecisionMaker` trait:

```rust
impl HybridDecisionMaker for {组件名} {
    type Context = {上下文类型};
    type RuleResult = {规则引擎结果类型};
    type AgentResult = {Agent分析结果类型};
    type Decision = {最终决策类型};
    type Trigger = {触发条件类型};

    // 实现方法...
}
```

---

## 验收标准

- [ ] 功能正确实现
- [ ] 符合确定性/不确定性分层原则
- [ ] 通过单元测试
- [ ] 文档更新

---

## 参考资料

- `docs/architecture/CCODE_VS_ZERO.md` - ccode 与 zero-* 关系
- `docs/architecture/DESIGN_PHILOSOPHY.md` - 设计哲学
- `services/zero-trading/src/macro_agent/orchestrator.rs` - 混合模式参考实现
