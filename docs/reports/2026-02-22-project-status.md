# 项目状态快照 - 2026-02-22

## 架构概览

### 当前服务拓扑

```
┌─────────────────────────────────────────────────────────────┐
│                     用户交互层                               │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐    │
│  │ Telegram │  │  Feishu  │  │   Web    │  │   TUI    │    │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬─────┘    │
│       │             │             │             │          │
└───────┴─────────────┴─────────────┴─────────────┴──────────┘
                              │
┌─────────────────────────────┴───────────────────────────────┐
│                     服务网关层                               │
│  ┌──────────────────────────────────────────────────────┐   │
│  │               Zero Gateway (4402)                    │   │
│  │  • JWT 认证 & API Key 验证                           │   │
│  │  • Token 配额管理 & 计量                             │   │
│  │  • 请求路由 & 代理                                   │   │
│  │  • 并行多模型推理                                    │   │
│  └──────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────┴───────────────────────────────┐
│                     核心服务层                               │
│                                                             │
│  ┌──────────────────┐  ┌──────────────────┐                │
│  │  CodeCoder API   │  │  Zero Workflow   │                │
│  │     (4400)       │  │     (4405)       │                │
│  │  • 27 Agents     │  │  • Cron 调度     │                │
│  │  • 20+ Tools     │  │  • Git Webhooks  │                │
│  │  • Skill System  │  │  • Code Review   │                │
│  │  • MCP Server    │  │  • Workflow DSL  │                │
│  └──────────────────┘  └──────────────────┘                │
│                                                             │
│  ┌──────────────────┐  ┌──────────────────┐                │
│  │  Zero Channels   │  │ Faster Whisper   │                │
│  │     (4404)       │  │     (4403)       │                │
│  │  • IM 适配器     │  │  • 本地 STT      │                │
│  │  • Webhook 接收  │  │  • 低延迟        │                │
│  │  • 消息路由      │  │  • 多语言支持    │                │
│  └──────────────────┘  └──────────────────┘                │
│                                                             │
│  ┌──────────────────┐                                       │
│  │   Web Frontend   │                                       │
│  │     (4401)       │                                       │
│  │  • Dashboard     │                                       │
│  │  • Chat UI       │                                       │
│  │  • Admin Panel   │                                       │
│  └──────────────────┘                                       │
└─────────────────────────────────────────────────────────────┘
```

### Monorepo 结构

```
/
├── packages/
│   ├── ccode/          # 核心 CLI 和业务逻辑
│   ├── util/           # 共享工具库
│   └── web/            # Web 前端 (Solid.js)
│
├── services/           # Rust 服务工作区
│   ├── zero-cli/       # CLI 客户端（原 zero-bot）
│   ├── zero-gateway/   # 网关服务
│   ├── zero-channels/  # 渠道适配
│   ├── zero-workflow/  # 工作流引擎
│   ├── zero-memory/    # 记忆模块
│   ├── zero-tools/     # 工具模块
│   ├── zero-agent/     # Agent 模块
│   └── zero-common/    # 共享组件
│
├── memory/             # 双层记忆系统
│   ├── MEMORY.md       # 长期记忆
│   └── daily/          # 每日笔记
│
└── docs/               # 文档
    ├── progress/       # 进行中的工作
    └── reports/        # 报告和已完成文档
```

---

## 最近完成的主要功能 (2026-02-16 至 2026-02-22)

### 架构重构

| 日期 | 功能 | 描述 |
|------|------|------|
| 02-21 | Zero-* 服务拆分 | 将 zero-bot 单体拆分为 8 个模块化服务 |
| 02-21 | Workspace 重构 | 创建 Rust workspace，1850+ 测试通过 |
| 02-21 | Zero-CLI 重构完成 | 所有 API 对齐问题修复，517/518 测试通过 |

### 智擎工作舱 (Omni-Nexus)

| 日期 | 版本/阶段 | 功能 |
|------|-----------|------|
| 02-21 | v3 核心 | 资源级 RBAC、敏感数据路由、统一配置中心 |
| 02-21 | v3 智能层 | Agent 注册发现、Skill 打包安装、Prompt 模板、Workflow DSL |
| 02-22 | v4 Phase 1 | ZeroBot→CodeCoder 桥接、Metering API、Registry API、Web 连接 |

### Agent 能力增强

| 日期 | 功能 | 描述 |
|------|------|------|
| 02-21 | 自举飞轮系统 | Agent 从经验学习，固化为可复用技能 |
| 02-21 | /crystallize 技能 | 手动触发技能固化 |
| 02-21 | 置信度系统 | 技能验证和演化机制 |

### MCP 集成

| 日期 | 功能 | 描述 |
|------|------|------|
| 02-20 | MCP Server | CodeCoder 作为 MCP Server 暴露能力 |
| 02-20 | HTTP 传输 | 支持 Streamable HTTP + API Key 认证 |
| 02-20 | 资源发现 | 动态资源发现 + Glob 模式 |

### 工作流与自动化

| 日期 | 功能 | 描述 |
|------|------|------|
| 02-21 | Workflow Engine | Cron 调度、Webhook 触发、工作流编排 |
| 02-21 | Git Code Review | GitHub/GitLab PR 自动代码审查 |
| 02-21 | IM 双向消息 | Telegram/Feishu 完整消息流 |
| 02-21 | Token 计量 | 配额检查、用量记录、报告生成 |

### 并行推理

| 日期 | 功能 | 描述 |
|------|------|------|
| 02-21 | 多模型并行 | 同一请求发送到多个 LLM，返回聚合结果 |
| 02-21 | Provider 抽象 | Anthropic、OpenAI 统一 Provider 接口 |

---

## 进行中的工作

| 任务 | 状态 | 描述 |
|------|------|------|
| Phase 15: CLI Client | 基础完成 | zero-cli HTTP 客户端实现，待逐步迁移本地模块 |
| TypeScript 类型修复 | 持续中 | 约 100+ 测试文件中的类型错误 |
| BookExpander | 阻塞 | Zod v4 + Bun escapeRegex 兼容性问题 |
| Web E2E 测试 | 待跟进 | Playwright 测试完善 |

---

## 已知问题和技术债务

### 高优先级

| 问题 | 状态 | 影响 |
|------|------|------|
| BookExpander Zod 兼容性 | 🚧 待解决 | BookExpander 模块无法使用 |
| ZeroBot 类型共享 | 🚧 待规划 | Rust/TS 类型手动维护，容易不一致 |

### 中优先级

| 问题 | 状态 | 影响 |
|------|------|------|
| 导入路径标准化 | 部分完成 | 混用三种导入方式 |
| Phase 15 剩余工作 | 进行中 | 本地模块逐步迁移到 zero-* 服务 |

### 低优先级

| 问题 | 状态 | 影响 |
|------|------|------|
| TS 严格模式 | 待评估 | 可启用更严格的 TypeScript 配置 |
| 测试类型错误 | 持续中 | 不影响核心功能和测试运行 |

---

## 下一步计划

### Phase 2: 场景配置层 (计划中)
- [ ] PRD 生成场景配置
- [ ] 技术评估场景配置
- [ ] 自动 Code Review 工作流

### Phase 3: 高级能力扩展 (计划中)
- [ ] 并行多模型调用 API
- [ ] Web Scraper Skill
- [ ] RAG Pipeline

### Phase 4: IDE 插件 (计划中)
- [ ] VS Code Extension
- [ ] JetBrains Plugin

### 持续改进
- [ ] 完成 Phase 15 CLI Client 迁移
- [ ] 解决 BookExpander Zod 兼容性
- [ ] 建立 Rust/TS 类型同步机制
- [ ] 修复剩余 TypeScript 类型错误

---

## 测试覆盖

### Rust 服务

| 服务 | 单元测试 | 集成测试 | 总计 |
|------|----------|----------|------|
| zero-cli | 1,143 | - | 1,143 |
| zero-common | 38 | - | 38 |
| zero-channels | 53 | 14 | 67 |
| zero-gateway | 57 | 17 | 74 |
| zero-workflow | 13 | 23 | 36 |
| **总计** | **1,304** | **54** | **1,358** |

### TypeScript

| 类型 | 文件数 |
|------|--------|
| E2E | 21 |
| Unit | 33 |
| Integration | 18 |
| Performance | 4 |
| A11Y | 2 |

**目标**: 保持 80%+ 覆盖率

---

*文档生成时间: 2026-02-22*
