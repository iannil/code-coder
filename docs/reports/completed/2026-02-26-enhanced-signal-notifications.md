# Enhanced Signal Notifications Implementation

**æ—¥æœŸ**: 2026-02-26
**çŠ¶æ€**: å·²å®Œæˆ
**æ¨¡å—**: zero-trading/notification

---

## æ¦‚è¿°

æœ¬æ¬¡å®ç°å¢å¼ºäº† zero-trading çš„ä¿¡å·é€šçŸ¥åŠŸèƒ½ï¼Œåœ¨åŸæœ‰åŸºç¡€ä¿¡å·æ¶ˆæ¯ä¸Šæ·»åŠ äº†æ‰§è¡Œå»ºè®®ã€ä»“ä½å»ºè®®ã€é£é™©æç¤ºå’Œæ—¶æ•ˆæ€§æŒ‡ç¤ºï¼Œä½¿äº¤æ˜“è€…èƒ½å¤Ÿæ›´å¿«é€Ÿåœ°åšå‡ºå†³ç­–ã€‚

## å®ç°å†…å®¹

### 1. å¢å¼ºçš„ä¿¡å·é€šçŸ¥æ–¹æ³•

åœ¨ `NotificationClient` ä¸­æ–°å¢ `send_trading_signal_with_recommendation()` æ–¹æ³•ï¼š

```rust
pub async fn send_trading_signal_with_recommendation(
    &self,
    signal: &TradingSignal,
    macro_env: Option<&MacroEnvironment>,
) -> Result<()>
```

### 2. æ‰§è¡Œå»ºè®®ç”Ÿæˆ

æ ¹æ®ä¿¡å·å¼ºåº¦å’Œå®è§‚ç¯å¢ƒç”Ÿæˆæ‰§è¡Œå»ºè®®ï¼š

| ä¿¡å·å¼ºåº¦ | å»ºè®® |
|---------|------|
| VeryStrong | æå¼ºä¿¡å·ï¼Œé«˜ç½®ä¿¡åº¦å…¥åœºæœºä¼š |
| Strong | å¼ºä¿¡å·ï¼Œå¯è€ƒè™‘æ ‡å‡†ä»“ä½å…¥åœº |
| Medium | ä¸­ç­‰ä¿¡å·ï¼Œå»ºè®®è½»ä»“è¯•æ¢ |
| Weak | å¼±ä¿¡å·ï¼Œè§‚æœ›ä¸ºä¸» |

å®è§‚ç¯å¢ƒå› ç´ ï¼š
- Bullish: å®è§‚ç¯å¢ƒçœ‹å¤šï¼Œæ”¯æŒåšå¤šä¿¡å·
- Neutral: å®è§‚ç¯å¢ƒä¸­æ€§ï¼ŒæŒ‰ä¿¡å·å¼ºåº¦æ“ä½œ
- Bearish: å®è§‚ç¯å¢ƒåç©ºï¼Œåšå¤šä¿¡å·éœ€è°¨æ…
- AvoidTrading: å®è§‚ç¯å¢ƒä¸åˆ©ï¼Œå»ºè®®æš‚ç¼“æ“ä½œ

### 3. ä»“ä½å»ºè®®

åŸºäºä¿¡å·å¼ºåº¦å’Œå®è§‚ç³»æ•°è®¡ç®—å»ºè®®ä»“ä½ï¼š

```
å»ºè®®ä»“ä½ = min(åŸºç¡€ä»“ä½ Ã— å®è§‚ç³»æ•°, 20%)

åŸºç¡€ä»“ä½:
- VeryStrong: 15%
- Strong: 10%
- Medium: 5%
- Weak: 0% (è§‚æœ›)
```

### 4. é£é™©æç¤º

è‡ªåŠ¨ç”Ÿæˆçš„é£é™©æç¤ºåŒ…æ‹¬ï¼š
- T+1è§„åˆ™æé†’ï¼ˆAè‚¡å½“æ—¥ä¹°å…¥æ¬¡æ—¥æ–¹å¯å–å‡ºï¼‰
- æ­¢æŸè·ç¦»è¯„ä¼°ï¼ˆ>5%è­¦å‘Šï¼Œ3-5%æ­£å¸¸ï¼Œ<3%è‰¯å¥½ï¼‰
- é£é™©å›æŠ¥æ¯”è¯„ä¼°ï¼ˆâ‰¥3:1ä¼˜è´¨ï¼Œâ‰¥2:1åˆç†ï¼Œ<2:1åä½ï¼‰

### 5. æ—¶æ•ˆæ€§æŒ‡ç¤º

æ ¹æ®ä¿¡å·ç”Ÿæˆæ—¶é—´æ˜¾ç¤ºæ—¶æ•ˆçŠ¶æ€ï¼š

| ä¿¡å·å¹´é¾„ | çŠ¶æ€ |
|---------|------|
| 0-5åˆ†é’Ÿ | ğŸ”´ åˆšäº§ç”Ÿ - å¯ç«‹å³è¯„ä¼° |
| 6-15åˆ†é’Ÿ | ğŸŸ¡ è¾ƒæ–°é²œ - å»ºè®®å°½å¿«è¯„ä¼° |
| 16-30åˆ†é’Ÿ | ğŸŸ¢ æœ‰æ•ˆæœŸå†… - ä»å¯è€ƒè™‘ |
| 31-60åˆ†é’Ÿ | âšª å³å°†è¿‡æœŸ - éœ€ç¡®è®¤æ˜¯å¦ä»æœ‰æ•ˆ |
| >60åˆ†é’Ÿ | â¬œ å·²è¿‡æœŸ - å»ºè®®ç­‰å¾…æ–°ä¿¡å· |

### 6. ç­–ç•¥æ‰«æå™¨é›†æˆ

æ›´æ–° `run_strategy_scanner()` ä½¿ç”¨å¢å¼ºé€šçŸ¥ï¼š

```rust
// Fetch macro environment for enhanced notifications
let macro_env = state.macro_filter.get_environment().await.ok();

// Send enhanced notifications
state.notification
    .send_trading_signal_with_recommendation(signal, macro_env.as_ref())
    .await
```

## æ¶ˆæ¯ç¤ºä¾‹

```
ğŸŸ¢ *000001.SZ* åšå¤šä¿¡å·

ğŸ“Š *ä¿¡å·å¼ºåº¦:* â­â­â­
ğŸ’° *å…¥åœºä»·:* 10.00
ğŸ›‘ *æ­¢æŸ:* 9.50 (5.0%)
ğŸ¯ *ç›®æ ‡:* 12.00 (20.0%)
ğŸ“ˆ *é£é™©å›æŠ¥:* 4.0:1
â° *å‘¨æœŸå…±æŒ¯:* Daily, H4

ğŸ“ *PO3ç»“æ„:*
  - é˜¶æ®µ: Distribution
  - ä¸­è½´çº¿: 10.75

ğŸŒ *å®è§‚ç¯å¢ƒ*
å‘¨æœŸé˜¶æ®µ: Expansion
äº¤æ˜“åå‘: Bullish
ä»“ä½ç³»æ•°: 1.2x
å¤‡æ³¨: PMI: 52.5 | M2åŒæ¯”: 10.5%

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“‹ *æ‰§è¡Œå»ºè®®*
å¼ºä¿¡å·ï¼Œå¯è€ƒè™‘æ ‡å‡†ä»“ä½å…¥åœº | å®è§‚ç¯å¢ƒçœ‹å¤šï¼Œæ”¯æŒåšå¤šä¿¡å·

ğŸ’° *ä»“ä½å»ºè®®*
å»ºè®®ä»“ä½: 12% (åŸºç¡€10% Ã— å®è§‚ç³»æ•°1.2)

âš ï¸ *é£é™©æç¤º*
ğŸ“Œ Aè‚¡T+1: ä»Šæ—¥ä¹°å…¥æ˜æ—¥æ–¹å¯å–å‡º
ğŸ’¡ æ­£å¸¸é£é™©: æ­¢æŸè·ç¦»é€‚ä¸­ï¼Œä¸¥æ ¼æ‰§è¡Œ
â­ ä¼˜è´¨R:R: é£é™©å›æŠ¥æ¯”â‰¥3:1

â° *æ—¶æ•ˆæ€§* ğŸ”´ åˆšäº§ç”Ÿ - å¯ç«‹å³è¯„ä¼°

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
_æ­¤ä¿¡å·ä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®_
```

## æµ‹è¯•è¦†ç›–

æ–°å¢ 14 ä¸ªå•å…ƒæµ‹è¯•éªŒè¯æ‰€æœ‰åŠŸèƒ½ï¼š

- `test_execution_recommendation_strong_bullish`
- `test_execution_recommendation_weak_bearish`
- `test_execution_recommendation_no_macro`
- `test_position_suggestion_very_strong`
- `test_position_suggestion_weak`
- `test_position_suggestion_capped_at_20`
- `test_risk_tips_high_risk`
- `test_risk_tips_good_rr`
- `test_urgency_indicator_fresh`
- `test_enhanced_message_format`
- `test_enhanced_message_without_macro`

## ä¿®æ”¹çš„æ–‡ä»¶

1. `services/zero-trading/src/notification.rs` - æ–°å¢å¢å¼ºé€šçŸ¥æ–¹æ³•å’Œæµ‹è¯•
2. `services/zero-trading/src/lib.rs` - é›†æˆå¢å¼ºé€šçŸ¥åˆ°ç­–ç•¥æ‰«æå™¨

## åç»­ä¼˜åŒ–å»ºè®®

1. **ä¿¡å·ç¡®è®¤æœºåˆ¶** (ä¸­ä¼˜å…ˆçº§)
   - æ”¯æŒ Telegram inline keyboard äº¤äº’å¼ç¡®è®¤
   - è®°å½•ç”¨æˆ·å†³ç­–åˆ°æ—¥å¿—

2. **å®æ—¶ä»·æ ¼ç›‘æ§** (ä¸­ä¼˜å…ˆçº§)
   - è¯„ä¼°æ˜¯å¦éœ€è¦ WebSocket å®æ—¶è¡Œæƒ…
   - å½“å‰ 1 åˆ†é’Ÿ K çº¿é—´éš”å¯¹äºæ­¢æŸè§¦å‘å¯èƒ½æœ‰å»¶è¿Ÿ

3. **ä¸ªæ€§åŒ–è®¾ç½®** (ä½ä¼˜å…ˆçº§)
   - å…è®¸ç”¨æˆ·é…ç½®é€šçŸ¥è¯¦ç»†ç¨‹åº¦
   - æ”¯æŒå…³é—­ç‰¹å®šç±»å‹çš„æç¤º
