# CodeCoder

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.0-blue.svg)](https://www.typescriptlang.org/)
[![Bun](https://img.shields.io/badge/Runtime-Bun-black.svg)](https://bun.sh/)

[English](./README.md)

一个融合工程能力与决策智慧的 AI 个人工作台。

CodeCoder 不只是一个编程助手。它是为所有正在被 AI 改变工作方式的人设计的综合平台——开发者、分析师、写作者、决策者、独立创作者。基于[祝融说](https://zhurongshuo.com)哲学框架构建，它将结构化思维与实用工具融为一体。

## 为什么选择 CodeCoder？

在 AI 普及的时代，挑战不在于如何访问 AI，而在于如何与 AI 一起思考。CodeCoder 通过以下方式应对这一挑战：

- 多维度辅助 - 不止于代码，还有决策、分析和内容创作
- 哲学根基 - CLOSE 框架支撑可持续决策
- 提供商灵活性 - 通过统一接口连接 30+ AI 提供商
- 专业化能力 - 23+ 面向不同领域的专业 Agent

## 核心哲学

CodeCoder 构建在一套独特的哲学框架之上，它重新定义了我们应对不确定性和做出决策的方式。

### 本体论：实在的生成

可能性基底

- 终极实在不是静态的「实体」，而是包含一切潜能的无限场域
- 一切确定的现实都是从这个「可能性海洋」中涌现的
- 过程优先于实体，生成（Becoming）优先于存在（Being）

观察即收敛

- 「观察」是一种创造性行为，而非被动接收
- 观察导致可能性「坍缩」为确定性
- 存在即被观察（To be is to be observed）

观察共识

- 宏观世界的稳定性源于多层级观察者的「共同投票」
- 物理定律是宇宙最底层的「规则共识」
- 社会现实是人类集体观察的「符号共识」

### 实践论：可持续决策

可用余量（Available Surplus）

- 尚未被固化的潜能空间
- 自由意志、创造力和系统韧性的来源
- 可持续决策保留余量；最优决策往往消耗余量

选择权优势

- 智慧选择在于为未来「预留可能性」
- 可持续决策 > 最优决策
- 保持「再来一次」的能力比追求「最优解」更重要

### CLOSE 五维评估框架

一套用于做出可持续选择的五维评估系统：

| 维度 | 核心问题 | 关注点 |
|------|----------|--------|
| Convergence 收敛 | 这个选择会收敛多少可能性？ | 保留未来选项 |
| Leverage 杠杆 | 是否存在非对称收益？ | 风险收益不对称性 |
| Optionality 选择权 | 这个决定可以反悔吗？成本多大？ | 可逆性 |
| Surplus 余量 | 消耗多少缓冲资源？ | 资源保护 |
| Evolution 演化 | 能带来成长和学习机会吗？ | 学习潜力 |

> 「可持续决策 > 最优决策。能够继续玩下去，比赢一次更重要。」

## 三层架构

CodeCoder 将能力组织为三个相互关联的层次：

### 工程层

代码审查、安全分析、TDD 指导、架构设计、逆向工程、形式化验证。

### 领域层

宏观经济、交易分析、选品策略、极小产品开发、AI 工程指导。

### 思维层

观察者理论分析、CLOSE 框架决策评估、可能性空间探索。

## 专业 Agent（23+）

### 主模式

| Agent | 描述 |
|-------|------|
| `build` | 主开发模式，具备完整能力 |
| `plan` | 只读探索和规划模式 |
| `autonomous` | 自主任务完成，配备安全护栏 |

### 工程类 Agent

| Agent | 用途 |
|-------|------|
| `code-reviewer` | 代码质量审查 - 识别代码异味、命名问题、可维护性 |
| `security-reviewer` | 安全漏洞分析 - OWASP Top 10、注入风险、认证问题 |
| `tdd-guide` | 测试驱动开发指导 - 红-绿-重构循环、覆盖率 |
| `architect` | 系统架构设计 - 接口定义、设计模式、技术决策 |
| `verifier` | 形式化验证 - 基于属性的测试、不变量验证 |
| `explore` | 快速代码库探索 - 模式搜索、结构理解 |

### 逆向工程

| Agent | 用途 |
|-------|------|
| `code-reverse` | 网站像素级复刻规划 |
| `jar-code-reverse` | Java JAR 文件分析与源码重建 |

### 领域类 Agent

| Agent | 用途 |
|-------|------|
| `macro` | 宏观经济分析 - GDP、通胀、货币政策、贸易数据 |
| `trader` | 超短线交易指导 - 情绪周期、模式识别（仅供教育参考） |
| `picker` | 选品策略 - 七宗罪选品法、市场机会发现 |
| `miniproduct` | 极小产品教练 - MVP 设计、AI 辅助开发、变现策略 |
| `ai-engineer` | AI 工程师导师 - Python、LLM 应用、RAG、微调、MLOps |

### 思维类 Agent

| Agent | 用途 |
|-------|------|
| `observer` | 观察者理论顾问 - 可能性空间分析、认知框架 |
| `decision` | 决策指导 - CLOSE 框架评估、可持续选择 |

### 内容类 Agent

| Agent | 用途 |
|-------|------|
| `writer` | 长文写作 - 2 万字以上文档、章节规划、风格一致性 |
| `proofreader` | 内容校对 - 语法、风格、PROOF 框架验证 |
| `expander` | 内容扩展 - 将想法转化为完整书籍 |

## 功能特性

### 多 AI 提供商支持

通过统一接口连接 30+ AI 提供商：

| 类别 | 提供商 |
|------|--------|
| 主流 | Anthropic Claude、OpenAI、Google Gemini、Amazon Bedrock、Azure |
| 专业 | xAI Grok、Mistral、Groq、Cerebras、Cohere |
| 聚合 | OpenRouter、Together AI、DeepInfra、Vercel AI |
| 企业 | GitHub Copilot、GitLab Duo、Google Vertex AI |
| 本地 | 任何 OpenAI 兼容端点（通过 MCP） |

### 语言服务器协议（LSP）

内置支持 30+ 语言服务器，自动安装：

TypeScript、Go、Rust、Python、Ruby、Java、Kotlin、C/C++、C#、Swift、Dart、Elixir、Zig、PHP、Lua、OCaml、Haskell、Clojure、Gleam 等。

### 模型上下文协议（MCP）

- 本地和远程 MCP 服务器
- OAuth 2.0 认证流程
- 动态工具发现
- SSE 流式支持

### 终端界面

基于 SolidJS 和 OpenTUI 构建的丰富终端界面：

- 完整键盘导航
- 支持分支的会话管理
- 实时流式响应
- 代码变更差异可视化

### 记忆系统

透明、Git 友好的记忆架构：

- 每日笔记：`./memory/daily/{YYYY-MM-DD}.md` - 只追加的每日日志
- 长期记忆：`./memory/MEMORY.md` - 整理后的知识和偏好

所有记忆都是人类可读的 Markdown，受版本控制，可手动编辑。

## 安装

### 环境要求

- [Bun](https://bun.sh/) 1.3 或更高版本
- macOS、Linux 或 Windows（推荐 WSL）

### 从源码安装

```bash
git clone https://github.com/iannil/code-coder.git
cd code-coder
bun install
bun dev
```

### 构建独立可执行文件

```bash
cd packages/ccode
bun run build
```

## 快速开始

```bash
# 启动交互式 TUI
ccode

# 或指定工作目录
ccode /path/to/project

# CLI 模式直接发送消息
ccode run "解释这个代码库的架构"

# 继续上次会话
ccode run --continue

# 使用特定 Agent
ccode run --agent architect "设计一个用户管理的 REST API"
ccode run --agent decision "我应该接受这份工作邀请吗？"
ccode run --agent macro "解读最新的 PMI 数据"

# 无头服务器模式
ccode serve --port 4096
```

## 配置

### 配置文件位置（优先级顺序）

1. 全局：`~/.codecoder/config.json`
2. 项目：`./codecoder.json` 或 `./.ccode/codecoder.json`
3. 环境变量：`CCODE_CONFIG` 或 `CCODE_CONFIG_CONTENT`

### 配置示例

```json
{
  "$schema": "https://code-coder.com/config.json",
  "model": "anthropic/claude-sonnet-4-20250514",
  "default_agent": "build",
  "provider": {
    "anthropic": {
      "options": { "apiKey": "{env:ANTHROPIC_API_KEY}" }
    }
  },
  "permission": {
    "bash": {
      "*": "ask",
      "git *": "allow",
      "npm *": "allow"
    }
  },
  "mcp": {
    "filesystem": {
      "type": "local",
      "command": ["npx", "@anthropic/mcp-filesystem"]
    }
  }
}
```

## 架构

```
┌─────────────────────────────────────────────────────────────┐
│                      CodeCoder CLI                          │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐          │
│  │   TUI 应用   │  │  CLI 命令   │  │   服务器    │          │
│  │  (SolidJS)  │  │  (yargs)    │  │   (API)     │          │
│  └─────────────┘  └─────────────┘  └─────────────┘          │
├─────────────────────────────────────────────────────────────┤
│                       核心引擎                               │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐        │
│  │  Agent   │ │  Session │ │   Tool   │ │ Provider │        │
│  │  系统    │ │  管理器   │ │   系统   │ │   系统   │        │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘        │
├─────────────────────────────────────────────────────────────┤
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐        │
│  │   MCP    │ │   记忆   │ │   LSP    │ │   Hook   │        │
│  │   协议   │ │   系统   │ │   系统   │ │   系统   │        │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘        │
├─────────────────────────────────────────────────────────────┤
│                      AI 提供商                               │
│  Anthropic │ OpenAI │ Google │ AWS │ Azure │ OpenRouter...  │
└─────────────────────────────────────────────────────────────┘
```

### 技术栈

- 运行时：Bun 1.3+ + TypeScript ESM
- UI 框架：OpenTUI + SolidJS
- 验证：Zod schemas
- AI SDK：Vercel AI SDK 多提供商支持
- 构建：Bun 原生打包器

## 项目结构

```
codecoder/
├── packages/
│   ├── ccode/           # 核心 CLI 和业务逻辑
│   │   ├── src/
│   │   │   ├── agent/   # Agent 定义和提示词
│   │   │   ├── cli/     # CLI 命令和 TUI
│   │   │   ├── provider/# AI 提供商集成
│   │   │   ├── mcp/     # MCP 协议支持
│   │   │   ├── lsp/     # LSP 集成
│   │   │   └── tool/    # 内置工具
│   │   └── test/        # 测试套件
│   └── util/            # 共享工具库
├── script/              # 构建和生成脚本
├── docs/                # 文档
└── memory/              # 记忆存储
```

## 开发

```bash
# 安装依赖
bun install

# 开发模式运行
bun dev

# 类型检查
bun turbo typecheck

# 运行测试（从包目录）
cd packages/ccode && bun test

# 构建可执行文件
bun run --cwd packages/ccode build
```

## 命令参考

```bash
# 认证
ccode auth login <provider>
ccode auth logout <provider>
ccode auth list

# 会话管理
ccode session list
ccode session show <id>
ccode session delete <id>

# Agent 管理
ccode agent list
ccode agent generate

# 模型管理
ccode models list
ccode models default

# MCP 服务器管理
ccode mcp list
ccode mcp auth <name>
ccode mcp connect <name>

# 记忆管理
ccode memory show
ccode memory clear

# 逆向工程
ccode reverse <url>
ccode jar-reverse <file>
```

## 贡献

欢迎贡献！详情请参阅[贡献指南](./docs/CONTRIB.md)。

1. Fork 本仓库
2. 创建功能分支（`git checkout -b feature/amazing-feature`）
3. 按照[约定式提交](https://www.conventionalcommits.org/zh-hans/)规范提交更改
4. 推送到分支（`git push origin feature/amazing-feature`）
5. 创建 Pull Request

## 许可证

本项目基于 MIT 许可证开源 - 详情请参阅 [LICENSE](LICENSE) 文件。

## 致谢

- 使用 [Bun](https://bun.sh) 构建 - 快速的一体化 JavaScript 运行时
- 由 [Vercel AI SDK](https://sdk.vercel.ai) 驱动 - 多提供商 AI 集成
- UI 由 [OpenTUI](https://github.com/sst/opentui) 提供支持 - 终端 UI 框架

---

<p align="center">
  <strong>CodeCoder</strong> - 工程与智慧的交汇
</p>
